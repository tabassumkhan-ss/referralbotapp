<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Ref786App ‚Äî Smart Referral System</title>
  <script src="https://telegram.org/js/telegram-web-app.js"></script>
  <style>
    * { box-sizing: border-box; }
    body {
      margin:0; height:100vh; display:flex; align-items:center; justify-content:center;
      font-family: system-ui, -apple-system, "Segoe UI", Roboto, Arial, sans-serif;
      text-align:center; color:#fff;
      background: radial-gradient(1200px 600px at 50% -20%, rgba(255,255,255,.08), transparent 60%),
                  linear-gradient(135deg, #5c3cff, #0e1630 60%);
      overflow:hidden;
    }
    .card {
      width:min(560px, 92vw);
      background: rgba(255,255,255,0.06);
      border: 1px solid rgba(255,255,255,0.15);
      border-radius: 20px;
      padding: 28px 22px;
      box-shadow: 0 18px 50px rgba(0,0,0,.25);
      backdrop-filter: blur(6px);
    }

    /* Base avatar style */
    .logo {
      width: 88px; height: 88px; border-radius: 50%; object-fit: cover;
      border: 4px solid rgba(255,255,255,.35); margin: 0 auto 14px; display:block;
      box-shadow: 0 10px 26px rgba(0,0,0,.35), 0 0 0 8px rgba(255,255,255,.08) inset;
      position: relative;
    }

    /* Neon glow ring for registered state */
    .logo.glow {
      border-color: transparent;
      box-shadow: none;
      isolation: isolate;
    }
    .logo.glow::before, .logo.glow::after {
      content: ""; position: absolute; inset: -6px; border-radius: 50%;
      z-index: -1;
    }
    /* Outer animated neon gradient ring */
    .logo.glow::before {
      background: conic-gradient(
        from 0deg,
        #6cf 0%, #8af 25%, #9ff 50%, #7df 75%, #6cf 100%
      );
      filter: blur(6px);
      animation: spin 4s linear infinite;
      opacity: .95;
    }
    /* Inner soft glow halo */
    .logo.glow::after {
      inset: -14px;
      background: radial-gradient(closest-side, rgba(108,240,255,.5), rgba(0,0,0,0));
      filter: blur(10px);
      opacity: .65;
    }
    @keyframes spin {
      to { transform: rotate(360deg); }
    }

    h2 { margin: 0 0 10px; font-weight: 700; }
    .row { margin:10px 0; font-size: 1.05rem; }
    .big { font-size: 1.25rem; font-weight: 700; }
    .actions { margin-top:16px; display:flex; gap:12px; justify-content:center; }
    .btn {
      padding:11px 22px; border-radius:22px; border:0; cursor:pointer; font-weight:600;
      background:#00c853; color:#fff; box-shadow:0 8px 24px rgba(0,200,83,.35);
    }
    .btn.alt { background:#e53935; box-shadow:0 8px 24px rgba(229,57,53,.35); }

    /* Referral line with copy icon */
    .ref-line {
      display:flex; align-items:center; justify-content:center; gap:10px; margin-top:8px;
    }
    .copy-btn {
      display:inline-flex; align-items:center; justify-content:center;
      width:36px; height:36px; border-radius:10px; border:none; cursor:pointer;
      background: rgba(255,255,255,.16); color:#fff; font-size:18px;
      transition: transform .12s ease, opacity .2s;
    }
    .copy-btn:active { transform: scale(.96); }
    .hint { font-size:.85rem; opacity:.85; margin-top:8px; }
    .tooltip { margin-top:8px; font-size:.85rem; opacity:0; transition:opacity .25s; }
    .show { opacity:1; }
  </style>
</head>
<body>
  <div class="card" id="app">
    <img src="./Botlogo.png" alt="Ref786App Logo" class="logo" id="avatar" />
    <h2>Do you want to Register?</h2>
    <div class="actions">
      <button class="btn" id="yesBtn">‚úÖ Yes</button>
      <button class="btn alt" id="noBtn">‚ùå No</button>
    </div>
  </div>

  <script>
    const tg = window.Telegram.WebApp;
    tg.ready(); tg.expand();

    const app = document.getElementById('app');
    const baseLogo = './Botlogo.png';

    function showConfirmation(userId, name, avatarUrl) {
      const referralUrl = `https://t.me/ref786bot?start=${userId}`;
      app.innerHTML = `
        <img src="${avatarUrl || baseLogo}" alt="User Avatar" class="logo glow" />
        <div class="row big" id="uid">${userId}</div>
        <div class="row" id="uname">${name}</div>

        <div class="row ref-line">
          <span>Referral Link</span>
          <button class="copy-btn" id="copyBtn" title="Copy referral link">üìã</button>
        </div>
        
        <div class="tooltip" id="tooltip">Copied!</div>
      `;

      const copyBtn = document.getElementById('copyBtn');
      const tooltip = document.getElementById('tooltip');
      copyBtn.onclick = async () => {
        try {
          await navigator.clipboard.writeText(referralUrl);
          tooltip.classList.add('show');
          setTimeout(() => tooltip.classList.remove('show'), 1200);
          tg.HapticFeedback?.impactOccurred('medium');
        } catch { alert('Failed to copy link'); }
      };

      tg.HapticFeedback?.notificationOccurred('success');
    }

    document.getElementById('yesBtn').onclick = () => {
      const u = tg.initDataUnsafe?.user || {};
      const id   = u.id ?? Math.floor(Math.random()*1000000000);
      const name = [u.first_name, u.last_name].filter(Boolean).join(' ')
                || (u.username ? '@' + u.username : 'Unknown');
      const avatarUrl = u.photo_url || baseLogo;  // Telegram may provide photo_url
      showConfirmation(id, name, avatarUrl);
    };

    document.getElementById('noBtn').onclick = () => {
      app.innerHTML = `
        <img src="${baseLogo}" alt="Ref786App Logo" class="logo" />
        <div class="row big">‚ùå Registration Cancelled</div>
      `;
      tg.HapticFeedback?.notificationOccurred('error');
    };
  </script>
</body>
</html>

