<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Ref786App — Smart Referral System</title>
  <script src="https://telegram.org/js/telegram-web-app.js"></script>
  <style>
    :root { --pad:20px; }
    * { box-sizing: border-box; }
    body {
      margin:0; height:100vh; display:flex; flex-direction:column; align-items:center; justify-content:center;
      font-family: system-ui, -apple-system, "Segoe UI", Roboto, Arial, sans-serif;
      text-align:center; color:#fff;
      background: radial-gradient(1200px 600px at 50% -20%, rgba(255,255,255,.08), transparent 60%),
                  linear-gradient(135deg, #5c3cff, #0e1630 60%);
    }
    .logo {
      width: 128px; height: 128px; border-radius: 50%;
      border: 4px solid rgba(255,255,255,.5);
      box-shadow: 0 12px 30px rgba(0,0,0,.35), 0 0 0 8px rgba(255,255,255,.08) inset;
      object-fit: cover; margin-bottom: 18px;
    }
    h2 { margin: 0 0 18px; font-weight: 700; letter-spacing:.3px; }
    .tag { opacity:.85; margin-bottom: 26px; }
    .row { display:flex; gap:16px; justify-content:center; flex-wrap:wrap; }
    button {
      padding: 12px 28px; font-size: 16px; font-weight: 600; border:0; border-radius: 28px; cursor:pointer;
      transition: transform .15s ease, box-shadow .2s ease, opacity .2s ease;
    }
    button:active { transform: scale(.98); }
    .yes { background:#00c853; color:#fff; box-shadow:0 8px 24px rgba(0,200,83,.35); }
    .no  { background:#e53935; color:#fff; box-shadow:0 8px 24px rgba(229,57,53,.35); }
    .foot { position:fixed; bottom:14px; left:0; right:0; opacity:.75; font-size:.9rem; }
  </style>
</head>
<body>
  <img src="./Botlogo.png" alt="Ref786App Logo" class="logo" />
  <h2>Do you want to Register?</h2>
  <div class="tag">Smart Referral System</div>

  <div class="row">
    <button class="yes" id="yesBtn">✅ Yes</button>
    <button class="no"  id="noBtn">❌ No</button>
  </div>

  <div class="foot">Ref786App • Telegram Mini App</div>

  <script>
    const tg = window.Telegram.WebApp;
    tg.ready(); tg.expand();

    function hasTelegramContext() {
      // Must have signed initData and user object when opened from a chat/webview
      return !!(tg.initData && tg.initDataUnsafe && tg.initDataUnsafe.user);
    }

    document.getElementById("yesBtn").onclick = () => {
      if (!hasTelegramContext()) {
        // No chat context → open the bot chat so the bot can reply immediately
        tg.openTelegramLink("https://t.me/ref786bot?start=register");
        return;
      }
      const u = tg.initDataUnsafe.user || {};
      const payload = {
        action: "register",
        user_id: u.id ?? null,
        username: u.username ?? null,
        first_name: u.first_name ?? null,
        last_name: u.last_name ?? null,
        start_param: tg.initDataUnsafe?.start_param ?? null
      };
      tg.sendData(JSON.stringify(payload)); // goes to your bot chat
      tg.close(); // show the bot's reply immediately
    };

    document.getElementById("noBtn").onclick = () => {
      if (hasTelegramContext()) {
        tg.sendData(JSON.stringify({ action: "cancel" }));
        tg.close();
      } else {
        tg.openTelegramLink("https://t.me/ref786bot");
      }
    };
  </script>
</body>
</html>
